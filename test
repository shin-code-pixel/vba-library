Option Explicit

Public Sub VBL_CreateTestCaseSheet(Optional ByVal sheetName As String = "TestCases")
    Dim wb As Workbook: Set wb = ThisWorkbook
    Dim ws As Worksheet
    
    If SheetExists(wb, sheetName) Then
        If MsgBox("シート '" & sheetName & "' は既に存在します。削除して作り直しますか？", vbYesNo + vbQuestion) <> vbYes Then Exit Sub
        Application.DisplayAlerts = False
        wb.Worksheets(sheetName).Delete
        Application.DisplayAlerts = True
    End If
    
    Set ws = wb.Worksheets.Add(After:=wb.Worksheets(wb.Worksheets.Count))
    ws.Name = sheetName
    
    Dim headers As Variant
    headers = Array( _
        "TC_ID", _
        "対象（モジュール/関数/画面）", _
        "観点（VAL/BND/FMT/IO/FLOW/ERR/CON/PERF/CFG）", _
        "前提条件", _
        "入力", _
        "操作", _
        "期待結果", _
        "実結果", _
        "判定（OK/NG）", _
        "証跡（ファイル/スクショ/ログ）", _
        "備考" _
    )
    
    Dim i As Long
    For i = LBound(headers) To UBound(headers)
        ws.Cells(1, i + 1).Value = headers(i)
    Next
    
    With ws.Range(ws.Cells(1, 1), ws.Cells(1, UBound(headers) + 1))
        .Font.Bold = True
        .WrapText = True
        .VerticalAlignment = xlVAlignCenter
        .Interior.Color = RGB(230, 230, 230)
    End With
    
    ws.Rows(1).RowHeight = 36
    ws.Columns(1).ColumnWidth = 12
    ws.Columns(2).ColumnWidth = 28
    ws.Columns(3).ColumnWidth = 18
    ws.Columns(4).ColumnWidth = 22
    ws.Columns(5).ColumnWidth = 18
    ws.Columns(6).ColumnWidth = 18
    ws.Columns(7).ColumnWidth = 26
    ws.Columns(8).ColumnWidth = 26
    ws.Columns(9).ColumnWidth = 12
    ws.Columns(10).ColumnWidth = 22
    ws.Columns(11).ColumnWidth = 22
    
    ws.Activate
    ws.Range("A2").Select
    ActiveWindow.FreezePanes = True
    
    ws.Range("A1").Select
End Sub

Private Function SheetExists(ByVal wb As Workbook, ByVal sheetName As String) As Boolean
    On Error Resume Next
    SheetExists = Not wb.Worksheets(sheetName) Is Nothing
    On Error GoTo 0
End Function
